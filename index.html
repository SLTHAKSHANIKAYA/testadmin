<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centronix | Admin Panel</title>
    
    <link rel="icon" type="image/png" href="centronix_logo_only.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #06b6d4;
            --bg-deep: #02040a;
            --bg-card: #0a0d14;
            --bg-input: #0f1219;
            --border: rgba(255,255,255,0.08);
            --border-hover: rgba(255,255,255,0.15);
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --grad-glow: linear-gradient(90deg, #7c3aed, #0891b2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-deep);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* =========================================
           LOGIN SCREEN
           ========================================= */
        .login-screen {
            height: 100vh; display: flex; align-items: center;
            justify-content: center; flex-direction: column;
            background: radial-gradient(circle at center, rgba(139,92,246,0.05), transparent 70%);
        }
        .login-box {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 24px; padding: 3rem; width: 90%; max-width: 420px;
            text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .login-logo { width: 70px; height: 70px; margin: 0 auto 1.5rem; filter: drop-shadow(0 0 15px var(--primary)); display: block; }
        .login-title { font-family: 'Space Grotesk'; font-size: 1.8rem; margin-bottom: 0.5rem; }
        .login-subtitle { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 2rem; }
        .google-btn {
            width: 100%; padding: 14px 20px; border-radius: 12px;
            border: 1px solid var(--border); background: var(--bg-input);
            color: white; font-size: 1rem; font-weight: 500;
            cursor: pointer; transition: 0.3s; display: flex;
            align-items: center; justify-content: center; gap: 12px;
            font-family: 'Inter', sans-serif;
        }
        .google-btn:hover { border-color: var(--primary); background: rgba(139,92,246,0.1); box-shadow: 0 0 20px rgba(139,92,246,0.15); }
        .google-btn img { width: 22px; height: 22px; }
        .login-error {
            margin-top: 1rem; padding: 12px; border-radius: 10px;
            background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2);
            color: var(--danger); font-size: 0.85rem; display: none; text-align: left;
        }

        /* =========================================
           ADMIN LAYOUT
           ========================================= */
        .admin-wrapper { display: none; min-height: 100vh; }
        .admin-wrapper.active { display: flex; }

        /* SIDEBAR */
        .sidebar {
            width: 260px; background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 1.5rem; position: fixed; top: 0; left: 0;
            height: 100vh; overflow-y: auto; z-index: 100; transition: 0.3s;
            display: flex; flex-direction: column;
        }
        .sidebar-logo { display: flex; align-items: center; gap: 10px; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem; flex-shrink: 0; }
        .sidebar-logo img { height: 28px; filter: drop-shadow(0 0 5px var(--primary)); }
        .sidebar-logo span { font-family: 'Space Grotesk'; font-weight: 700; font-size: 1rem; letter-spacing: 1px; }
        .sidebar-badge { font-size: 0.6rem; padding: 2px 7px; background: var(--primary); border-radius: 8px; margin-left: 4px; font-weight: 600; }

        .sidebar-nav { flex: 1; overflow-y: auto; }
        .nav-section { font-size: 0.65rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; margin: 1.5rem 0 0.6rem; padding-left: 10px; }
        .sidebar-link {
            display: flex; align-items: center; gap: 10px;
            padding: 9px 10px; border-radius: 8px; color: var(--text-muted);
            text-decoration: none; font-size: 0.85rem; transition: 0.3s;
            margin-bottom: 3px; cursor: pointer; border: 1px solid transparent;
        }
        .sidebar-link:hover { background: rgba(255,255,255,0.05); color: white; }
        .sidebar-link.active { background: rgba(139,92,246,0.15); color: white; border-color: rgba(139,92,246,0.2); }
        .sidebar-link i { width: 18px; text-align: center; font-size: 0.85rem; }
        .sidebar-link .badge { margin-left: auto; background: var(--primary); color: white; font-size: 0.65rem; padding: 2px 7px; border-radius: 8px; }
        .sidebar-link .admin-tag { margin-left: auto; font-size: 0.6rem; background: var(--warning); color: black; padding: 1px 5px; border-radius: 5px; font-weight: 600; }

        .sidebar-user {
            padding: 1rem 0 0; border-top: 1px solid var(--border);
            margin-top: auto; display: flex; align-items: center; gap: 10px; flex-shrink: 0;
        }
        .sidebar-user img { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--primary); }
        .sidebar-user-name { font-size: 0.8rem; font-weight: 600; }
        .sidebar-user-email { font-size: 0.65rem; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 130px; display: block; }

        /* MAIN CONTENT */
        .main-content { flex: 1; margin-left: 260px; padding: 2rem; min-height: 100vh; }

        /* TOP BAR */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 1rem; }
        .top-bar h1 { font-family: 'Space Grotesk'; font-size: 1.6rem; display: flex; align-items: center; gap: 10px; }
        .top-bar h1 i { color: var(--primary); }
        .top-bar-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

        /* BUTTONS */
        .btn {
            padding: 8px 16px; border-radius: 10px; border: 1px solid var(--border);
            background: var(--bg-input); color: white; font-size: 0.82rem;
            cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; gap: 7px;
            font-family: 'Inter', sans-serif; text-decoration: none;
        }
        .btn:hover { border-color: var(--primary); }
        .btn-primary { background: var(--grad-glow); border: none; box-shadow: 0 0 15px rgba(139,92,246,0.3); }
        .btn-primary:hover { box-shadow: 0 0 25px rgba(139,92,246,0.5); }
        .btn-danger { border-color: var(--danger); color: var(--danger); }
        .btn-danger:hover { background: rgba(239,68,68,0.1); }
        .btn-sm { padding: 5px 10px; font-size: 0.78rem; }
        .btn-full { width: 100%; justify-content: center; padding: 13px; }

        /* =========================================
           DASHBOARD
           ========================================= */
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.2rem; margin-bottom: 1.5rem; }
        .dash-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; padding: 1.3rem; transition: 0.3s; }
        .dash-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        .dash-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; }
        .dash-card-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .dash-card-value { font-family: 'Space Grotesk'; font-size: 1.8rem; font-weight: 700; }
        .dash-card-label { color: var(--text-muted); font-size: 0.8rem; margin-top: 0.2rem; }

        /* PANELS */
        .panel { display: none; animation: fadeIn 0.3s ease; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* DATA TABLE */
        .table-wrap { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 550px; }
        .data-table th { text-align: left; padding: 12px 16px; font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); background: rgba(255,255,255,0.02); }
        .data-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); font-size: 0.85rem; vertical-align: middle; }
        .data-table tr:hover td { background: rgba(255,255,255,0.02); }
        .data-table tr:last-child td { border-bottom: none; }

        /* STATUS */
        .badge-status { padding: 3px 10px; border-radius: 15px; font-size: 0.7rem; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
        .badge-active { background: rgba(34,197,94,0.1); color: var(--success); border: 1px solid rgba(34,197,94,0.2); }
        .badge-inactive { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid rgba(239,68,68,0.2); }

        /* TOGGLE */
        .toggle { width: 42px; height: 22px; background: #334155; border-radius: 11px; position: relative; cursor: pointer; transition: 0.3s; display: inline-block; }
        .toggle.on { background: var(--success); }
        .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle.on::after { left: 22px; }

        /* =========================================
           FORMS & MODALS
           ========================================= */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9999; display: none; place-items: center; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .modal-overlay.active { display: grid; }
        .admin-modal {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 18px; padding: 2rem; width: 90%; max-width: 580px;
            max-height: 85vh; overflow-y: auto; animation: fadeIn 0.3s ease;
        }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .modal-header h3 { font-family: 'Space Grotesk'; font-size: 1.2rem; }
        .modal-close { cursor: pointer; font-size: 1.4rem; color: var(--text-muted); background: none; border: none; transition: 0.3s; padding: 5px; }
        .modal-close:hover { color: white; }

        .form-group { margin-bottom: 1.1rem; }
        .form-label { display: block; font-size: 0.82rem; color: var(--text-muted); margin-bottom: 0.4rem; font-weight: 500; }
        .form-input {
            width: 100%; background: var(--bg-input); border: 1px solid var(--border);
            padding: 11px 14px; border-radius: 9px; color: white;
            font-family: 'Inter', sans-serif; font-size: 0.88rem; transition: 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 12px rgba(139,92,246,0.1); }
        .form-input::placeholder { color: #475569; }
        textarea.form-input { resize: vertical; min-height: 90px; }
        select.form-input { appearance: none; -webkit-appearance: none; cursor: pointer; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .form-hint { font-size: 0.72rem; color: #475569; margin-top: 0.3rem; }
        .form-hint a { color: var(--accent); }
        .form-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 1.3rem; padding-top: 1.3rem; border-top: 1px solid var(--border); }

        /* CONFIG CARD */
        .config-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 1.3rem; margin-bottom: 1.3rem;
        }
        .config-card h4 { font-family: 'Space Grotesk'; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; font-size: 1rem; }
        .config-card h4 i { color: var(--primary); font-size: 0.9rem; }

        /* RESPONSE CARD */
        .response-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 10px; padding: 1.1rem; margin-bottom: 0.8rem; transition: 0.3s;
        }
        .response-card:hover { border-color: var(--border-hover); }
        .response-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.6rem; flex-wrap: wrap; gap: 6px; }
        .response-keyword { background: rgba(139,92,246,0.15); color: var(--primary); padding: 2px 8px; border-radius: 5px; font-size: 0.75rem; font-weight: 600; font-family: monospace; }
        .response-text { color: var(--text-muted); font-size: 0.82rem; line-height: 1.5; white-space: pre-line; max-height: 80px; overflow: hidden; }
        .response-footer { display: flex; gap: 6px; margin-top: 0.6rem; align-items: center; }

        /* PORTFOLIO GRID */
        .port-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.2rem; }
        .port-item { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; transition: 0.3s; }
        .port-item:hover { border-color: var(--border-hover); }
        .port-item img { width: 100%; height: 120px; object-fit: cover; border-bottom: 1px solid var(--border); display: block; }
        .port-item-info { padding: 0.8rem; }
        .port-item-info h4 { font-size: 0.88rem; margin-bottom: 0.2rem; }
        .port-item-info p { font-size: 0.75rem; color: var(--text-muted); }
        .port-item-actions { display: flex; gap: 6px; padding: 0 0.8rem 0.8rem; }

        /* SEARCH */
        .search-box {
            background: var(--bg-input); border: 1px solid var(--border);
            border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; gap: 8px;
        }
        .search-box input { background: none; border: none; color: white; font-size: 0.85rem; font-family: 'Inter'; width: 100%; }
        .search-box input:focus { outline: none; }
        .search-box input::placeholder { color: #475569; }
        .search-box i { color: var(--text-muted); font-size: 0.85rem; }

        /* TOAST */
        .toast-container { position: fixed; top: 15px; right: 15px; z-index: 99999; display: flex; flex-direction: column; gap: 8px; }
        .toast { padding: 12px 18px; border-radius: 10px; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; animation: slideRight 0.3s ease; min-width: 280px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .toast-success { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); color: var(--success); }
        .toast-error { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: var(--danger); }
        .toast-info { background: rgba(6,182,212,0.15); border: 1px solid rgba(6,182,212,0.3); color: var(--accent); }
        @keyframes slideRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* EMPTY STATE */
        .empty-state { text-align: center; padding: 3rem 2rem; }
        .empty-state i { font-size: 2.5rem; color: #334155; margin-bottom: 0.8rem; display: block; }
        .empty-state h3 { color: var(--text-muted); margin-bottom: 0.4rem; font-family: 'Space Grotesk'; font-size: 1.1rem; }
        .empty-state p { color: #475569; font-size: 0.85rem; }

        /* WARNING BANNER */
        .warn-banner {
            background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2);
            border-radius: 10px; padding: 0.8rem 1.2rem; margin-bottom: 1.2rem;
            display: flex; align-items: flex-start; gap: 10px; font-size: 0.85rem;
        }
        .warn-banner i { color: var(--warning); font-size: 1.1rem; margin-top: 2px; flex-shrink: 0; }
        .warn-banner strong { color: var(--warning); }

        /* SUPER ADMIN TAG */
        .admin-crown {
            display: flex; align-items: center; gap: 8px; padding: 8px 12px;
            background: rgba(139,92,246,0.1); border: 1px solid rgba(139,92,246,0.15);
            border-radius: 8px; margin-bottom: 6px; font-size: 0.85rem;
        }
        .admin-crown i { color: var(--primary); }

        /* QUICK ACTIONS */
        .quick-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.8rem; }

        /* MOBILE SIDEBAR */
        .mobile-toggle {
            display: none; position: fixed; top: 12px; left: 12px;
            z-index: 200; background: var(--bg-card); border: 1px solid var(--border);
            width: 38px; height: 38px; border-radius: 8px;
            color: white; font-size: 1rem; cursor: pointer;
            align-items: center; justify-content: center;
        }

        /* =========================================
           RESPONSIVE
           ========================================= */
        @media (max-width: 900px) {
            .mobile-toggle { display: flex; }
            .sidebar { transform: translateX(-100%); position: fixed; z-index: 150; }
            .sidebar.open { transform: translateX(0); box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .main-content { margin-left: 0; padding: 1rem; padding-top: 3.5rem; }
            .form-row { grid-template-columns: 1fr; }
            .dash-grid { grid-template-columns: 1fr 1fr; }
            .top-bar { flex-direction: column; align-items: flex-start; }
            .top-bar-actions { width: 100%; }
        }
        @media (max-width: 480px) {
            .dash-grid { grid-template-columns: 1fr; }
            .port-grid { grid-template-columns: 1fr; }
            .quick-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- TOAST -->
    <div class="toast-container" id="toastBox"></div>

    <!-- ==========================================
         LOGIN SCREEN
         ========================================== -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <img src="centronix_logo_only.png" class="login-logo" alt="Centronix">
            <h2 class="login-title">Admin Panel</h2>
            <p class="login-subtitle">Sign in with your Google account to access the dashboard</p>
            <button class="google-btn" onclick="doGoogleLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G">
                Sign in with Google
            </button>
            <div class="login-error" id="loginError"></div>
        </div>
        <p style="color:#334155;font-size:0.75rem;margin-top:2rem;">© 2026 Centronix Admin System</p>
    </div>

    <!-- MOBILE SIDEBAR TOGGLE -->
    <button class="mobile-toggle" id="mobileToggle" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
    </button>

    <!-- ==========================================
         ADMIN WRAPPER
         ========================================== -->
    <div class="admin-wrapper" id="adminWrapper">

        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <img src="centronix_logo_only.png" alt="C">
                <span>CENTRONIX</span>
                <span class="sidebar-badge">ADMIN</span>
            </div>

            <div class="sidebar-nav">
                <div class="nav-section">Main</div>
                <div class="sidebar-link active" onclick="showPanel('dashboard')" data-panel="dashboard">
                    <i class="fa-solid fa-grid-2"></i> Dashboard
                </div>

                <div class="nav-section">Content</div>
                <div class="sidebar-link" onclick="showPanel('company')" data-panel="company">
                    <i class="fa-solid fa-building"></i> Company Info
                </div>
                <div class="sidebar-link" onclick="showPanel('testimonials')" data-panel="testimonials">
                    <i class="fa-solid fa-star"></i> Testimonials
                    <span class="badge" id="countTestimonials">0</span>
                </div>
                <div class="sidebar-link" onclick="showPanel('portfolio')" data-panel="portfolio">
                    <i class="fa-solid fa-briefcase"></i> Portfolio
                    <span class="badge" id="countPortfolio">0</span>
                </div>
                <div class="sidebar-link" onclick="showPanel('services')" data-panel="services">
                    <i class="fa-solid fa-cogs"></i> Services
                    <span class="badge" id="countServices">0</span>
                </div>

                <div class="nav-section">AI Chatbot</div>
                <div class="sidebar-link" onclick="showPanel('chatbot')" data-panel="chatbot">
                    <i class="fa-solid fa-robot"></i> Bot Responses
                    <span class="badge" id="countResponses">0</span>
                </div>
                <div class="sidebar-link" onclick="showPanel('aiconfig')" data-panel="aiconfig">
                    <i class="fa-solid fa-brain"></i> AI Config
                </div>

                <div class="nav-section">System</div>
                <div class="sidebar-link" onclick="showPanel('submissions')" data-panel="submissions">
                    <i class="fa-solid fa-envelope"></i> Submissions
                    <span class="badge" id="countSubmissions">0</span>
                </div>
                <div class="sidebar-link" onclick="showPanel('settings')" data-panel="settings" id="settingsLink">
                    <i class="fa-solid fa-gear"></i> Settings
                    <span class="admin-tag">ADMIN</span>
                </div>
                <div class="sidebar-link" onclick="doLogout()" style="color:var(--danger);margin-top:0.5rem;">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </div>
            </div>

            <div class="sidebar-user">
                <img src="" alt="U" id="userPhoto">
                <div>
                    <div class="sidebar-user-name" id="userName">Loading...</div>
                    <span class="sidebar-user-email" id="userEmail">...</span>
                </div>
            </div>
        </aside>

        <!-- ==========================================
             MAIN CONTENT
             ========================================== -->
        <main class="main-content">

            <!-- PANEL: DASHBOARD -->
            <div class="panel active" id="panel-dashboard">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-grid-2"></i> Dashboard</h1>
                    <div class="top-bar-actions">
                        <a href="centronix.html" target="_blank" class="btn"><i class="fa-solid fa-external-link"></i> View Website</a>
                    </div>
                </div>

                <div class="dash-grid">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <div>
                                <div class="dash-card-value" id="dashTestimonials">0</div>
                                <div class="dash-card-label">Testimonials</div>
                            </div>
                            <div class="dash-card-icon" style="background:rgba(139,92,246,0.15);color:var(--primary);"><i class="fa-solid fa-star"></i></div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <div>
                                <div class="dash-card-value" id="dashPortfolio">0</div>
                                <div class="dash-card-label">Portfolio Items</div>
                            </div>
                            <div class="dash-card-icon" style="background:rgba(6,182,212,0.15);color:var(--accent);"><i class="fa-solid fa-briefcase"></i></div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <div>
                                <div class="dash-card-value" id="dashResponses">0</div>
                                <div class="dash-card-label">Bot Responses</div>
                            </div>
                            <div class="dash-card-icon" style="background:rgba(34,197,94,0.15);color:var(--success);"><i class="fa-solid fa-robot"></i></div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <div>
                                <div class="dash-card-value" id="dashSubmissions">0</div>
                                <div class="dash-card-label">Form Submissions</div>
                            </div>
                            <div class="dash-card-icon" style="background:rgba(245,158,11,0.15);color:var(--warning);"><i class="fa-solid fa-envelope"></i></div>
                        </div>
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-bolt"></i> Quick Actions</h4>
                    <div class="quick-grid">
                        <button class="btn" onclick="showPanel('testimonials')" style="justify-content:center;"><i class="fa-solid fa-plus"></i> Add Testimonial</button>
                        <button class="btn" onclick="showPanel('portfolio')" style="justify-content:center;"><i class="fa-solid fa-plus"></i> Add Portfolio</button>
                        <button class="btn" onclick="showPanel('chatbot')" style="justify-content:center;"><i class="fa-solid fa-plus"></i> Add Bot Response</button>
                        <button class="btn" onclick="showPanel('company')" style="justify-content:center;"><i class="fa-solid fa-pen"></i> Edit Company</button>
                    </div>
                </div>
            </div>

            <!-- PANEL: COMPANY INFO -->
            <div class="panel" id="panel-company">
                <div class="top-bar"><h1><i class="fa-solid fa-building"></i> Company Information</h1></div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-circle-info"></i> Basic Details</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" id="cName" placeholder="Centronix">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tagline</label>
                            <input type="text" class="form-input" id="cTagline" placeholder="Architecture of Intelligence">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="text" class="form-input" id="cPhone" placeholder="+94 77 123 4567">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="cEmail" placeholder="hello@centronix.lk">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Website URL</label>
                            <input type="text" class="form-input" id="cWebsite" placeholder="https://centronix.lk">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" id="cLocation" placeholder="Sri Lanka">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">About Description</label>
                        <textarea class="form-input" id="cAbout" placeholder="Company description..."></textarea>
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-brands fa-facebook"></i> Social Media</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Facebook</label>
                            <input type="text" class="form-input" id="cFacebook" placeholder="https://facebook.com/...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Instagram</label>
                            <input type="text" class="form-input" id="cInstagram" placeholder="https://instagram.com/...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">LinkedIn</label>
                            <input type="text" class="form-input" id="cLinkedin" placeholder="https://linkedin.com/...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">GitHub</label>
                            <input type="text" class="form-input" id="cGithub" placeholder="https://github.com/...">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">WhatsApp (with country code)</label>
                        <input type="text" class="form-input" id="cWhatsapp" placeholder="+94771234567">
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-chart-bar"></i> Homepage Stats</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Projects Count</label>
                            <input type="text" class="form-input" id="cStatProjects" placeholder="100+">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Client Retention</label>
                            <input type="text" class="form-input" id="cStatRetention" placeholder="98%">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">User Interactions</label>
                            <input type="text" class="form-input" id="cStatInteractions" placeholder="50M+">
                        </div>
                        <div class="form-group">
                            <label class="form-label">System Uptime</label>
                            <input type="text" class="form-input" id="cStatUptime" placeholder="24/7">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="saveCompany()">
                    <i class="fa-solid fa-floppy-disk"></i> Save All Company Information
                </button>
            </div>

            <!-- PANEL: TESTIMONIALS -->
            <div class="panel" id="panel-testimonials">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-star"></i> Testimonials</h1>
                    <div class="top-bar-actions">
                        <button class="btn btn-primary" onclick="openTestimonialModal()"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
                <div id="testimonialsList"></div>
            </div>

            <!-- PANEL: PORTFOLIO -->
            <div class="panel" id="panel-portfolio">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-briefcase"></i> Portfolio</h1>
                    <div class="top-bar-actions">
                        <div style="display:flex;align-items:center;gap:8px;margin-right:10px;">
                            <span style="font-size:0.82rem;color:var(--text-muted);">Show on Website:</span>
                            <div class="toggle" id="portToggle" onclick="togglePortfolio()"></div>
                        </div>
                        <button class="btn btn-primary" onclick="openPortfolioModal()"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
                <p style="color:var(--text-muted);font-size:0.82rem;margin-bottom:1.2rem;">
                    <i class="fa-solid fa-info-circle"></i> Add completed projects & client brands. Toggle to show/hide on website.
                </p>
                <div class="port-grid" id="portfolioList"></div>
            </div>

            <!-- PANEL: SERVICES -->
            <div class="panel" id="panel-services">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-cogs"></i> Services</h1>
                    <div class="top-bar-actions">
                        <button class="btn btn-primary" onclick="openServiceModal()"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
                <div id="servicesList"></div>
            </div>

            <!-- PANEL: CHATBOT RESPONSES -->
            <div class="panel" id="panel-chatbot">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-robot"></i> Bot Responses</h1>
                    <div class="top-bar-actions">
                        <div class="search-box" style="max-width:220px;">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" placeholder="Search keywords..." oninput="searchBot(this.value)">
                        </div>
                        <button class="btn btn-primary" onclick="openResponseModal()"><i class="fa-solid fa-plus"></i> Add</button>
                    </div>
                </div>
                <p style="color:var(--text-muted);font-size:0.82rem;margin-bottom:1.2rem;">
                    <i class="fa-solid fa-info-circle"></i> Use <strong>{phone}</strong>, <strong>{email}</strong>, <strong>{website}</strong> as placeholders. They auto-fill from Company Info.
                </p>
                <div id="responsesList"></div>
            </div>

            <!-- PANEL: AI CONFIG -->
            <div class="panel" id="panel-aiconfig">
                <div class="top-bar"><h1><i class="fa-solid fa-brain"></i> AI Configuration</h1></div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-toggle-on"></i> Chatbot Mode</h4>
                    <div style="display:flex;flex-direction:column;gap:0.8rem;">
                        <label style="display:flex;align-items:flex-start;gap:10px;padding:1rem;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;cursor:pointer;">
                            <input type="radio" name="chatMode" value="stored" checked style="margin-top:3px;accent-color:var(--primary);">
                            <div>
                                <strong>Stored Responses (Default)</strong>
                                <p style="color:var(--text-muted);font-size:0.82rem;margin-top:0.2rem;">Uses keyword-response pairs. Free & fully controlled by you.</p>
                            </div>
                        </label>
                        <label style="display:flex;align-items:flex-start;gap:10px;padding:1rem;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;cursor:pointer;">
                            <input type="radio" name="chatMode" value="ai" style="margin-top:3px;accent-color:var(--primary);">
                            <div>
                                <strong>AI Powered (OpenAI)</strong>
                                <p style="color:var(--text-muted);font-size:0.82rem;margin-top:0.2rem;">Uses GPT for intelligent responses. Requires API key. Falls back to stored if API fails.</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="config-card" id="aiKeyBox" style="display:none;">
                    <h4><i class="fa-solid fa-key"></i> OpenAI API Key</h4>
                    <div class="form-group">
                        <label class="form-label">API Key</label>
                        <input type="password" class="form-input" id="aiKey" placeholder="sk-...">
                        <p class="form-hint">Get key: <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">System Prompt (Bot Personality)</label>
                        <textarea class="form-input" id="aiPrompt" rows="3" placeholder="You are Centronix AI assistant..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Tokens</label>
                        <input type="number" class="form-input" id="aiTokens" value="200" min="50" max="1000">
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-message"></i> Fallback Message</h4>
                    <div class="form-group">
                        <label class="form-label">When bot doesn't understand</label>
                        <textarea class="form-input" id="aiFallback" rows="3" placeholder="Sorry, I didn't understand..."></textarea>
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="saveAIConfig()">
                    <i class="fa-solid fa-floppy-disk"></i> Save AI Configuration
                </button>
            </div>

            <!-- PANEL: CONTACT SUBMISSIONS -->
            <div class="panel" id="panel-submissions">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-envelope"></i> Contact Submissions</h1>
                    <div class="top-bar-actions">
                        <button class="btn btn-danger" onclick="clearCollection('contactSubmissions','submissions')">
                            <i class="fa-solid fa-trash"></i> Clear All
                        </button>
                    </div>
                </div>
                <div id="submissionsList"></div>
            </div>

            <!-- PANEL: SETTINGS (Super Admin Only) -->
            <div class="panel" id="panel-settings">
                <div class="top-bar">
                    <h1><i class="fa-solid fa-gear"></i> Settings</h1>
                    <div class="top-bar-actions">
                        <span class="badge-status badge-active"><i class="fa-solid fa-shield-halved"></i> Super Admin</span>
                    </div>
                </div>

                <div class="warn-banner">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    <div>
                        <strong>Super Admin Only</strong>
                        <p style="color:var(--text-muted);font-size:0.82rem;margin:0;">Only the main admin can see and modify these settings.</p>
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-user-shield"></i> Admin Access Control</h4>
                    <div class="admin-crown">
                        <i class="fa-solid fa-crown"></i>
                        <span>Super Admin: <strong>jprabodha123@gmail.com</strong> (cannot be removed)</span>
                    </div>
                    <div class="form-group" style="margin-top:1rem;">
                        <label class="form-label">Allowed Admin Emails (one per line)</label>
                        <textarea class="form-input" id="adminEmails" rows="4" placeholder="team@centronix.lk&#10;other@gmail.com"></textarea>
                        <p class="form-hint">Only these emails + super admin can login.</p>
                    </div>
                    <button class="btn btn-primary" onclick="saveAdminEmails()">
                        <i class="fa-solid fa-floppy-disk"></i> Save Access List
                    </button>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-users"></i> Current Access List</h4>
                    <div id="accessList"></div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-database"></i> Data Management</h4>
                    <div style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button class="btn" onclick="loadDefaults('responses')"><i class="fa-solid fa-download"></i> Default Bot Responses</button>
                        <button class="btn" onclick="loadDefaults('testimonials')"><i class="fa-solid fa-download"></i> Default Testimonials</button>
                        <button class="btn btn-danger" onclick="clearCollection('botResponses','chatbot')"><i class="fa-solid fa-trash"></i> Clear Responses</button>
                        <button class="btn btn-danger" onclick="clearCollection('testimonials','testimonials')"><i class="fa-solid fa-trash"></i> Clear Testimonials</button>
                        <button class="btn btn-danger" onclick="clearCollection('portfolio','portfolio')"><i class="fa-solid fa-trash"></i> Clear Portfolio</button>
                        <button class="btn btn-danger" onclick="clearCollection('services','services')"><i class="fa-solid fa-trash"></i> Clear Services</button>
                    </div>
                </div>

                <div class="config-card">
                    <h4><i class="fa-solid fa-info-circle"></i> System Info</h4>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.8rem;">
                        <div><span style="color:var(--text-muted);font-size:0.82rem;">Version</span><p style="font-weight:600;">1.0.0</p></div>
                        <div><span style="color:var(--text-muted);font-size:0.82rem;">Firebase</span><p style="font-weight:600;">centronix-admin-edd12</p></div>
                        <div><span style="color:var(--text-muted);font-size:0.82rem;">Database</span><p style="font-weight:600;">Cloud Firestore</p></div>
                        <div><span style="color:var(--text-muted);font-size:0.82rem;">Auth</span><p style="font-weight:600;">Google OAuth 2.0</p></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ==========================================
         MODALS
         ========================================== -->

    <!-- Testimonial Modal -->
    <div class="modal-overlay" id="modalTestimonial">
        <div class="admin-modal">
            <div class="modal-header">
                <h3 id="titleTestimonial">Add Testimonial</h3>
                <button class="modal-close" onclick="closeModals()">&times;</button>
            </div>
            <input type="hidden" id="editTId">
            <div class="form-row">
                <div class="form-group"><label class="form-label">Client Name *</label><input type="text" class="form-input" id="tName" placeholder="John Doe"></div>
                <div class="form-group"><label class="form-label">Position</label><input type="text" class="form-input" id="tPos" placeholder="CEO, Company"></div>
            </div>
            <div class="form-group"><label class="form-label">Review *</label><textarea class="form-input" id="tReview" rows="3" placeholder="Their review..."></textarea></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Rating</label>
                    <select class="form-input" id="tRating"><option value="5">★★★★★</option><option value="4">★★★★☆</option><option value="3">★★★☆☆</option><option value="2">★★☆☆☆</option><option value="1">★☆☆☆☆</option></select>
                </div>
                <div class="form-group"><label class="form-label">Status</label>
                    <select class="form-input" id="tStatus"><option value="active">Active</option><option value="inactive">Hidden</option></select>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTestimonial()"><i class="fa-solid fa-floppy-disk"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- Portfolio Modal -->
    <div class="modal-overlay" id="modalPortfolio">
        <div class="admin-modal">
            <div class="modal-header">
                <h3 id="titlePortfolio">Add Portfolio Item</h3>
                <button class="modal-close" onclick="closeModals()">&times;</button>
            </div>
            <input type="hidden" id="editPId">
            <div class="form-group"><label class="form-label">Project/Brand Name *</label><input type="text" class="form-input" id="pName" placeholder="Client Brand"></div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-input" id="pDesc" rows="2" placeholder="Brief description..."></textarea></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Category</label>
                    <select class="form-input" id="pCat"><option value="web">Web</option><option value="mobile">Mobile</option><option value="ai">AI/ML</option><option value="branding">Branding</option><option value="marketing">Marketing</option><option value="other">Other</option></select>
                </div>
                <div class="form-group"><label class="form-label">Status</label>
                    <select class="form-input" id="pStatus"><option value="active">Active</option><option value="inactive">Hidden</option></select>
                </div>
            </div>
            <div class="form-group"><label class="form-label">Project URL (optional)</label><input type="text" class="form-input" id="pUrl" placeholder="https://..."></div>
            <div class="form-group"><label class="form-label">Image URL</label><input type="text" class="form-input" id="pImg" placeholder="https://... or filename.png"><p class="form-hint">Image URL or local filename</p></div>
            <div class="form-group"><label class="form-label">Technologies</label><input type="text" class="form-input" id="pTech" placeholder="React, Node.js (comma separated)"></div>
            <div class="form-actions">
                <button class="btn" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="savePortfolio()"><i class="fa-solid fa-floppy-disk"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div class="modal-overlay" id="modalService">
        <div class="admin-modal">
            <div class="modal-header">
                <h3 id="titleService">Add Service</h3>
                <button class="modal-close" onclick="closeModals()">&times;</button>
            </div>
            <input type="hidden" id="editSId">
            <div class="form-row">
                <div class="form-group"><label class="form-label">Service Name *</label><input type="text" class="form-input" id="sName" placeholder="Web Engineering"></div>
                <div class="form-group"><label class="form-label">Icon (Font Awesome)</label><input type="text" class="form-input" id="sIcon" placeholder="fa-solid fa-code"><p class="form-hint"><a href="https://fontawesome.com/icons" target="_blank">Browse icons</a></p></div>
            </div>
            <div class="form-group"><label class="form-label">Short Description</label><input type="text" class="form-input" id="sShort" placeholder="Brief..."></div>
            <div class="form-group"><label class="form-label">Full Description</label><textarea class="form-input" id="sFull" rows="2" placeholder="Detailed..."></textarea></div>
            <div class="form-group"><label class="form-label">Features (one per line)</label><textarea class="form-input" id="sFeatures" rows="3" placeholder="Feature 1&#10;Feature 2"></textarea></div>
            <div class="form-group"><label class="form-label">Tech Stack (comma separated)</label><input type="text" class="form-input" id="sTech" placeholder="React, Next.js"></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Image</label><input type="text" class="form-input" id="sImg" placeholder="web_dev.jpg"></div>
                <div class="form-group"><label class="form-label">Status</label>
                    <select class="form-input" id="sStatus"><option value="active">Active</option><option value="inactive">Hidden</option></select>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="saveService()"><i class="fa-solid fa-floppy-disk"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- Bot Response Modal -->
    <div class="modal-overlay" id="modalResponse">
        <div class="admin-modal">
            <div class="modal-header">
                <h3 id="titleResponse">Add Bot Response</h3>
                <button class="modal-close" onclick="closeModals()">&times;</button>
            </div>
            <input type="hidden" id="editRId">
            <div class="form-group"><label class="form-label">Keywords * (comma separated)</label><input type="text" class="form-input" id="rKeys" placeholder="price, cost, pricing"><p class="form-hint">If user message contains any keyword, this response is sent.</p></div>
            <div class="form-group"><label class="form-label">Response *</label><textarea class="form-input" id="rResp" rows="5" placeholder="Bot reply... Use {phone}, {email}, {website}"></textarea><p class="form-hint">Use <strong>{phone}</strong>, <strong>{email}</strong>, <strong>{website}</strong> for auto-fill.</p></div>
            <div class="form-row">
                <div class="form-group"><label class="form-label">Priority (higher = first)</label><input type="number" class="form-input" id="rPri" value="0" min="0" max="100"></div>
                <div class="form-group"><label class="form-label">Status</label>
                    <select class="form-input" id="rStatus"><option value="active">Active</option><option value="inactive">Hidden</option></select>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn" onclick="closeModals()">Cancel</button>
                <button class="btn btn-primary" onclick="saveResponse()"><i class="fa-solid fa-floppy-disk"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="modalConfirm">
        <div class="admin-modal" style="max-width:380px;text-align:center;">
            <div style="font-size:2.5rem;margin-bottom:0.8rem;">⚠️</div>
            <h3 style="font-family:'Space Grotesk';font-size:1.1rem;margin-bottom:0.5rem;" id="confirmTitle">Are you sure?</h3>
            <p style="color:var(--text-muted);margin-bottom:1.5rem;font-size:0.88rem;" id="confirmMsg">This cannot be undone.</p>
            <div style="display:flex;gap:8px;justify-content:center;">
                <button class="btn" onclick="closeModals()">Cancel</button>
                <button class="btn btn-danger" id="confirmBtn"><i class="fa-solid fa-trash"></i> Delete</button>
            </div>
        </div>
    </div>
    <script>
        // =========================================
        // 1. FIREBASE INIT
        // =========================================
        var firebaseConfig = {
            apiKey: "AIzaSyDenFBcNoqZPs0wnLDm4SCfmqsFKFurdtI",
            authDomain: "centronix-admin-edd12.firebaseapp.com",
            projectId: "centronix-admin-edd12",
            storageBucket: "centronix-admin-edd12.firebasestorage.app",
            messagingSenderId: "56818397978",
            appId: "1:56818397978:web:ee0e9b3bc12180505bf2a3"
        };

        firebase.initializeApp(firebaseConfig);
        var auth = firebase.auth();
        var db = firebase.firestore();
        var provider = new firebase.auth.GoogleAuthProvider();

        // =========================================
        // 2. GLOBALS
        // =========================================
        var currentUser = null;
        var allowedEmails = [];
        var SUPER_ADMIN = 'jprabodha123@gmail.com';

        // =========================================
        // 3. TOAST SYSTEM
        // =========================================
        function toast(msg, type) {
            type = type || 'info';
            var box = document.getElementById('toastBox');
            if (!box) return;
            var icons = { success: 'fa-check-circle', error: 'fa-times-circle', info: 'fa-info-circle' };
            var t = document.createElement('div');
            t.className = 'toast toast-' + type;
            t.innerHTML = '<i class="fa-solid ' + (icons[type] || icons.info) + '"></i> ' + msg;
            box.appendChild(t);
            setTimeout(function() {
                t.style.opacity = '0';
                t.style.transform = 'translateX(100%)';
                t.style.transition = '0.3s';
                setTimeout(function() { t.remove(); }, 300);
            }, 3500);
        }

        // =========================================
        // 4. AUTHENTICATION
        // =========================================
        async function loadAllowedEmails() {
            try {
                var doc = await db.collection('settings').doc('admin').get();
                if (doc.exists && doc.data().allowedEmails) {
                    allowedEmails = doc.data().allowedEmails;
                }
            } catch (e) {
                allowedEmails = [];
            }
            // Always include super admin
            if (allowedEmails.indexOf(SUPER_ADMIN) === -1) {
                allowedEmails.push(SUPER_ADMIN);
            }
        }

        function isSuperAdmin() {
            return currentUser && currentUser.email === SUPER_ADMIN;
        }

        function hasAccess(email) {
            if (allowedEmails.length === 0) return email === SUPER_ADMIN;
            return allowedEmails.indexOf(email) !== -1;
        }

        async function doGoogleLogin() {
            try {
                var result = await auth.signInWithPopup(provider);
                await loadAllowedEmails();
                if (!hasAccess(result.user.email)) {
                    auth.signOut();
                    var err = document.getElementById('loginError');
                    if (err) {
                        err.style.display = 'block';
                        err.innerHTML = '<i class="fa-solid fa-lock"></i> Access denied. <strong>' + result.user.email + '</strong> is not authorized.';
                    }
                }
            } catch (error) {
                var err = document.getElementById('loginError');
                if (err) {
                    err.style.display = 'block';
                    err.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> ' + error.message;
                }
            }
        }

        function doLogout() {
            auth.signOut();
            toast('Logged out', 'info');
        }

        // Auth state listener
        auth.onAuthStateChanged(async function(user) {
            if (user) {
                await loadAllowedEmails();
                if (!hasAccess(user.email)) {
                    auth.signOut();
                    var err = document.getElementById('loginError');
                    if (err) {
                        err.style.display = 'block';
                        err.innerHTML = '<i class="fa-solid fa-lock"></i> Access denied.';
                    }
                    return;
                }

                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminWrapper').classList.add('active');

                // User info
                var photo = document.getElementById('userPhoto');
                if (photo) photo.src = user.photoURL || '';
                var uname = document.getElementById('userName');
                if (uname) uname.textContent = user.displayName || 'Admin';
                var uemail = document.getElementById('userEmail');
                if (uemail) uemail.textContent = user.email;

                // Settings visibility
                var settingsLink = document.getElementById('settingsLink');
                if (settingsLink) {
                    settingsLink.style.display = isSuperAdmin() ? 'flex' : 'none';
                }

                // Init defaults & load data
                await initDefaults();
                await loadAllData();
                toast('Welcome, ' + (user.displayName || 'Admin') + '!', 'success');

            } else {
                currentUser = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminWrapper').classList.remove('active');
            }
        });

        // =========================================
        // 5. INIT DEFAULTS
        // =========================================
        async function initDefaults() {
            try {
                // Company
                var cDoc = await db.collection('settings').doc('company').get();
                if (!cDoc.exists) {
                    await db.collection('settings').doc('company').set({
                        name: 'Centronix', tagline: 'Architecture of Intelligence',
                        phone: '+94 77 123 4567', email: 'hello@centronix.lk',
                        website: 'https://centronix.lk', location: 'Sri Lanka',
                        about: 'Empowering enterprises with next-generation digital architecture.',
                        socialFacebook: '', socialInstagram: '', socialLinkedin: '', socialGithub: '',
                        socialWhatsapp: '+94771234567',
                        statProjects: '100+', statRetention: '98%', statInteractions: '50M+', statUptime: '24/7',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                // AI Config
                var aiDoc = await db.collection('settings').doc('aiConfig').get();
                if (!aiDoc.exists) {
                    await db.collection('settings').doc('aiConfig').set({
                        chatMode: 'stored', openaiKey: '', systemPrompt: '',
                        maxTokens: 200,
                        fallbackMessage: '🤔 Interesting question! Contact us:\n\n📧 {email}\n📞 {phone}\n\nOr use the contact form!',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (e) {
                console.error('Init defaults error:', e);
            }
        }

        // =========================================
        // 6. NAVIGATION
        // =========================================
        function showPanel(name) {
            // Hide all
            var panels = document.querySelectorAll('.panel');
            for (var i = 0; i < panels.length; i++) panels[i].classList.remove('active');

            // Show target
            var target = document.getElementById('panel-' + name);
            if (target) target.classList.add('active');

            // Update sidebar
            var links = document.querySelectorAll('.sidebar-link');
            for (var j = 0; j < links.length; j++) links[j].classList.remove('active');
            var activeLink = document.querySelector('[data-panel="' + name + '"]');
            if (activeLink) activeLink.classList.add('active');

            // Close mobile sidebar
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.classList.remove('open');
        }

        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.classList.toggle('open');
        }

        // =========================================
        // 7. LOAD ALL DATA
        // =========================================
        async function loadAllData() {
            try {
                await Promise.all([
                    loadCompany(),
                    loadTestimonials(),
                    loadPortfolio(),
                    loadServices(),
                    loadResponses(),
                    loadAIConfig(),
                    loadAdminEmails(),
                    loadSubmissions()
                ]);
            } catch (e) {
                console.error('Load all error:', e);
            }
        }

        // =========================================
        // 8. COMPANY CRUD
        // =========================================
        async function loadCompany() {
            try {
                var doc = await db.collection('settings').doc('company').get();
                if (!doc.exists) return;
                var d = doc.data();

                setValue('cName', d.name);
                setValue('cTagline', d.tagline);
                setValue('cPhone', d.phone);
                setValue('cEmail', d.email);
                setValue('cWebsite', d.website);
                setValue('cLocation', d.location);
                setValue('cAbout', d.about);
                setValue('cFacebook', d.socialFacebook);
                setValue('cInstagram', d.socialInstagram);
                setValue('cLinkedin', d.socialLinkedin);
                setValue('cGithub', d.socialGithub);
                setValue('cWhatsapp', d.socialWhatsapp);
                setValue('cStatProjects', d.statProjects);
                setValue('cStatRetention', d.statRetention);
                setValue('cStatInteractions', d.statInteractions);
                setValue('cStatUptime', d.statUptime);
            } catch (e) {
                console.error('Load company error:', e);
            }
        }

        function setValue(id, val) {
            var el = document.getElementById(id);
            if (el) el.value = val || '';
        }

        function getValue(id) {
            var el = document.getElementById(id);
            return el ? el.value.trim() : '';
        }

        async function saveCompany() {
            try {
                await db.collection('settings').doc('company').set({
                    name: getValue('cName'),
                    tagline: getValue('cTagline'),
                    phone: getValue('cPhone'),
                    email: getValue('cEmail'),
                    website: getValue('cWebsite'),
                    location: getValue('cLocation'),
                    about: getValue('cAbout'),
                    socialFacebook: getValue('cFacebook'),
                    socialInstagram: getValue('cInstagram'),
                    socialLinkedin: getValue('cLinkedin'),
                    socialGithub: getValue('cGithub'),
                    socialWhatsapp: getValue('cWhatsapp'),
                    statProjects: getValue('cStatProjects'),
                    statRetention: getValue('cStatRetention'),
                    statInteractions: getValue('cStatInteractions'),
                    statUptime: getValue('cStatUptime'),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                toast('Company info saved!', 'success');
            } catch (e) {
                toast('Error: ' + e.message, 'error');
            }
        }

        // =========================================
        // 9. TESTIMONIALS CRUD
        // =========================================
        async function loadTestimonials() {
            try {
                var snap = await db.collection('testimonials').orderBy('createdAt', 'desc').get();
                var list = document.getElementById('testimonialsList');
                var count = snap.size;

                setCount('countTestimonials', count);
                setCount('dashTestimonials', count);

                if (count === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fa-solid fa-star"></i><h3>No Testimonials</h3><p>Add your first testimonial.</p>' +
                        '<button class="btn btn-primary" onclick="openTestimonialModal()" style="margin-top:0.8rem;"><i class="fa-solid fa-plus"></i> Add</button></div>';
                    return;
                }

                var html = '<div class="table-wrap"><table class="data-table"><thead><tr><th>Client</th><th>Review</th><th>Rating</th><th>Status</th><th>Actions</th></tr></thead><tbody>';

                snap.forEach(function(doc) {
                    var d = doc.data();
                    var stars = '';
                    for (var i = 0; i < 5; i++) stars += i < (d.rating || 5) ? '★' : '☆';

                    html += '<tr>' +
                        '<td><strong>' + esc(d.name) + '</strong><br><span style="font-size:0.75rem;color:var(--text-muted);">' + esc(d.position) + '</span></td>' +
                        '<td style="max-width:250px;"><div style="color:var(--text-muted);font-size:0.82rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + esc(d.review) + '</div></td>' +
                        '<td style="color:#fbbf24;">' + stars + '</td>' +
                        '<td><span class="badge-status ' + (d.status === 'active' ? 'badge-active' : 'badge-inactive') + '">' + (d.status === 'active' ? '● Active' : '● Hidden') + '</span></td>' +
                        '<td><div style="display:flex;gap:4px;">' +
                            '<button class="btn btn-sm" onclick="editTestimonial(\'' + doc.id + '\')"><i class="fa-solid fa-pen"></i></button>' +
                            '<button class="btn btn-sm btn-danger" onclick="deleteItem(\'testimonials\',\'' + doc.id + '\',\'testimonials\')"><i class="fa-solid fa-trash"></i></button>' +
                        '</div></td></tr>';
                });

                html += '</tbody></table></div>';
                list.innerHTML = html;
            } catch (e) {
                toast('Error: ' + e.message, 'error');
            }
        }

        function openTestimonialModal(id) {
            document.getElementById('titleTestimonial').textContent = id ? 'Edit Testimonial' : 'Add Testimonial';
            document.getElementById('editTId').value = id || '';
            if (!id) { setValue('tName',''); setValue('tPos',''); setValue('tReview',''); setValue('tRating','5'); setValue('tStatus','active'); }
            document.getElementById('modalTestimonial').classList.add('active');
        }

        async function editTestimonial(id) {
            try {
                var doc = await db.collection('testimonials').doc(id).get();
                if (!doc.exists) return;
                var d = doc.data();
                document.getElementById('editTId').value = id;
                setValue('tName', d.name); setValue('tPos', d.position); setValue('tReview', d.review);
                setValue('tRating', d.rating || 5); setValue('tStatus', d.status || 'active');
                document.getElementById('titleTestimonial').textContent = 'Edit Testimonial';
                document.getElementById('modalTestimonial').classList.add('active');
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function saveTestimonial() {
            var name = getValue('tName');
            var review = getValue('tReview');
            if (!name || !review) { toast('Fill required fields', 'error'); return; }

            var data = {
                name: name, position: getValue('tPos'), review: review,
                rating: parseInt(getValue('tRating')) || 5, status: getValue('tStatus'),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            var editId = getValue('editTId');
            try {
                if (editId) {
                    await db.collection('testimonials').doc(editId).update(data);
                    toast('Testimonial updated!', 'success');
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('testimonials').add(data);
                    toast('Testimonial added!', 'success');
                }
                closeModals();
                await loadTestimonials();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 10. PORTFOLIO CRUD
        // =========================================
        async function loadPortfolio() {
            try {
                // Toggle state
                var setDoc = await db.collection('settings').doc('portfolio').get();
                var isVis = setDoc.exists ? (setDoc.data().visible === true) : false;
                var toggle = document.getElementById('portToggle');
                if (toggle) {
                    if (isVis) toggle.classList.add('on');
                    else toggle.classList.remove('on');
                }

                var snap = await db.collection('portfolio').orderBy('createdAt', 'desc').get();
                var list = document.getElementById('portfolioList');
                var count = snap.size;

                setCount('countPortfolio', count);
                setCount('dashPortfolio', count);

                if (count === 0) {
                    list.innerHTML = '<div class="empty-state" style="grid-column:1/-1;"><i class="fa-solid fa-briefcase"></i><h3>No Portfolio Items</h3><p>Add your projects & brands.</p>' +
                        '<button class="btn btn-primary" onclick="openPortfolioModal()" style="margin-top:0.8rem;"><i class="fa-solid fa-plus"></i> Add</button></div>';
                    return;
                }

                var html = '';
                snap.forEach(function(doc) {
                    var d = doc.data();
                    var img = d.image || 'https://placehold.co/400x300/0f172a/334155?text=No+Image';

                    html += '<div class="port-item">' +
                        '<img src="' + img + '" alt="' + esc(d.name) + '" onerror="this.src=\'https://placehold.co/400x300/0f172a/334155?text=No+Image\'">' +
                        '<div class="port-item-info"><h4>' + esc(d.name) + '</h4><p>' + esc(d.category) + '</p>' +
                        '<span class="badge-status ' + (d.status === 'active' ? 'badge-active' : 'badge-inactive') + '" style="margin-top:0.4rem;">' + (d.status === 'active' ? '● Active' : '● Hidden') + '</span></div>' +
                        '<div class="port-item-actions">' +
                            '<button class="btn btn-sm" onclick="editPortfolio(\'' + doc.id + '\')" style="flex:1;justify-content:center;"><i class="fa-solid fa-pen"></i> Edit</button>' +
                            '<button class="btn btn-sm btn-danger" onclick="deleteItem(\'portfolio\',\'' + doc.id + '\',\'portfolio\')"><i class="fa-solid fa-trash"></i></button>' +
                        '</div></div>';
                });

                list.innerHTML = html;
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function togglePortfolio() {
            var toggle = document.getElementById('portToggle');
            var isOn = toggle.classList.contains('on');
            toggle.classList.toggle('on');
            try {
                await db.collection('settings').doc('portfolio').set({ visible: !isOn }, { merge: true });
                toast('Portfolio ' + (!isOn ? 'visible' : 'hidden') + ' on website', 'success');
            } catch (e) {
                toggle.classList.toggle('on');
                toast('Error: ' + e.message, 'error');
            }
        }

        function openPortfolioModal(id) {
            document.getElementById('titlePortfolio').textContent = id ? 'Edit Portfolio' : 'Add Portfolio Item';
            document.getElementById('editPId').value = id || '';
            if (!id) { setValue('pName',''); setValue('pDesc',''); setValue('pCat','web'); setValue('pStatus','active'); setValue('pUrl',''); setValue('pImg',''); setValue('pTech',''); }
            document.getElementById('modalPortfolio').classList.add('active');
        }

        async function editPortfolio(id) {
            try {
                var doc = await db.collection('portfolio').doc(id).get();
                if (!doc.exists) return;
                var d = doc.data();
                document.getElementById('editPId').value = id;
                setValue('pName', d.name); setValue('pDesc', d.description); setValue('pCat', d.category);
                setValue('pStatus', d.status); setValue('pUrl', d.url); setValue('pImg', d.image); setValue('pTech', d.tech);
                document.getElementById('titlePortfolio').textContent = 'Edit Portfolio';
                document.getElementById('modalPortfolio').classList.add('active');
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function savePortfolio() {
            var name = getValue('pName');
            if (!name) { toast('Enter project name', 'error'); return; }

            var data = {
                name: name, description: getValue('pDesc'), category: getValue('pCat'),
                status: getValue('pStatus'), url: getValue('pUrl'), image: getValue('pImg'),
                tech: getValue('pTech'), updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            var editId = getValue('editPId');
            try {
                if (editId) {
                    await db.collection('portfolio').doc(editId).update(data);
                    toast('Portfolio updated!', 'success');
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('portfolio').add(data);
                    toast('Portfolio added!', 'success');
                }
                closeModals();
                await loadPortfolio();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // HELPER FUNCTIONS
        // =========================================
        function setCount(id, val) {
            var el = document.getElementById(id);
            if (el) el.textContent = val;
        }

        function esc(text) {
            if (!text) return '';
            var d = document.createElement('div');
            d.textContent = text;
            return d.innerHTML;
        }

        function closeModals() {
            var modals = document.querySelectorAll('.modal-overlay');
            for (var i = 0; i < modals.length; i++) modals[i].classList.remove('active');
        }

        // Close on overlay click
        (function() {
            var overlays = document.querySelectorAll('.modal-overlay');
            for (var i = 0; i < overlays.length; i++) {
                overlays[i].addEventListener('click', function(e) {
                    if (e.target === this) closeModals();
                });
            }
        })();

        // Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModals();
        });

        // Generic delete
        function deleteItem(collection, id, reloadPanel) {
            document.getElementById('confirmTitle').textContent = 'Delete this item?';
            document.getElementById('confirmMsg').textContent = 'This will be permanently removed.';
            document.getElementById('confirmBtn').innerHTML = '<i class="fa-solid fa-trash"></i> Delete';
            document.getElementById('confirmBtn').className = 'btn btn-danger';
            document.getElementById('confirmBtn').onclick = async function() {
                try {
                    await db.collection(collection).doc(id).delete();
                    toast('Deleted!', 'success');
                    closeModals();
                    if (reloadPanel === 'testimonials') await loadTestimonials();
                    if (reloadPanel === 'portfolio') await loadPortfolio();
                    if (reloadPanel === 'services') await loadServices();
                    if (reloadPanel === 'chatbot') await loadResponses();
                    if (reloadPanel === 'submissions') await loadSubmissions();
                } catch (e) { toast('Error: ' + e.message, 'error'); }
            };
            document.getElementById('modalConfirm').classList.add('active');
        }
        // =========================================
        // 11. SERVICES CRUD
        // =========================================
        async function loadServices() {
            try {
                var snap = await db.collection('services').orderBy('createdAt', 'desc').get();
                var list = document.getElementById('servicesList');
                var count = snap.size;

                setCount('countServices', count);

                if (count === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fa-solid fa-cogs"></i><h3>No Services</h3><p>Add your services.</p>' +
                        '<button class="btn btn-primary" onclick="openServiceModal()" style="margin-top:0.8rem;"><i class="fa-solid fa-plus"></i> Add</button></div>';
                    return;
                }

                var html = '<div class="table-wrap"><table class="data-table"><thead><tr><th>Service</th><th>Description</th><th>Tech</th><th>Status</th><th>Actions</th></tr></thead><tbody>';

                snap.forEach(function(doc) {
                    var d = doc.data();
                    html += '<tr>' +
                        '<td><div style="display:flex;align-items:center;gap:8px;">' +
                            '<div style="width:32px;height:32px;background:rgba(139,92,246,0.15);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">' +
                                '<i class="' + esc(d.icon || 'fa-solid fa-cog') + '" style="color:var(--primary);font-size:0.8rem;"></i>' +
                            '</div><strong>' + esc(d.name) + '</strong></div></td>' +
                        '<td style="max-width:200px;color:var(--text-muted);font-size:0.82rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + esc(d.shortDesc) + '</td>' +
                        '<td style="font-size:0.78rem;color:var(--accent);">' + esc(d.techStack) + '</td>' +
                        '<td><span class="badge-status ' + (d.status === 'active' ? 'badge-active' : 'badge-inactive') + '">' + (d.status === 'active' ? '● Active' : '● Hidden') + '</span></td>' +
                        '<td><div style="display:flex;gap:4px;">' +
                            '<button class="btn btn-sm" onclick="editService(\'' + doc.id + '\')"><i class="fa-solid fa-pen"></i></button>' +
                            '<button class="btn btn-sm btn-danger" onclick="deleteItem(\'services\',\'' + doc.id + '\',\'services\')"><i class="fa-solid fa-trash"></i></button>' +
                        '</div></td></tr>';
                });

                html += '</tbody></table></div>';
                list.innerHTML = html;
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        function openServiceModal(id) {
            document.getElementById('titleService').textContent = id ? 'Edit Service' : 'Add Service';
            document.getElementById('editSId').value = id || '';
            if (!id) {
                setValue('sName',''); setValue('sIcon',''); setValue('sShort','');
                setValue('sFull',''); setValue('sFeatures',''); setValue('sTech','');
                setValue('sImg',''); setValue('sStatus','active');
            }
            document.getElementById('modalService').classList.add('active');
        }

        async function editService(id) {
            try {
                var doc = await db.collection('services').doc(id).get();
                if (!doc.exists) return;
                var d = doc.data();
                document.getElementById('editSId').value = id;
                setValue('sName', d.name); setValue('sIcon', d.icon); setValue('sShort', d.shortDesc);
                setValue('sFull', d.fullDesc); setValue('sFeatures', d.features); setValue('sTech', d.techStack);
                setValue('sImg', d.image); setValue('sStatus', d.status);
                document.getElementById('titleService').textContent = 'Edit Service';
                document.getElementById('modalService').classList.add('active');
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function saveService() {
            var name = getValue('sName');
            if (!name) { toast('Enter service name', 'error'); return; }

            var data = {
                name: name, icon: getValue('sIcon'), shortDesc: getValue('sShort'),
                fullDesc: getValue('sFull'), features: getValue('sFeatures'),
                techStack: getValue('sTech'), image: getValue('sImg'), status: getValue('sStatus'),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            var editId = getValue('editSId');
            try {
                if (editId) {
                    await db.collection('services').doc(editId).update(data);
                    toast('Service updated!', 'success');
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('services').add(data);
                    toast('Service added!', 'success');
                }
                closeModals();
                await loadServices();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 12. BOT RESPONSES CRUD
        // =========================================
        async function loadResponses() {
            try {
                var snap = await db.collection('botResponses').orderBy('priority', 'desc').get();
                var list = document.getElementById('responsesList');
                var count = snap.size;

                setCount('countResponses', count);
                setCount('dashResponses', count);

                if (count === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fa-solid fa-robot"></i><h3>No Bot Responses</h3><p>Add responses or load defaults.</p>' +
                        '<div style="display:flex;gap:8px;justify-content:center;margin-top:0.8rem;flex-wrap:wrap;">' +
                        '<button class="btn btn-primary" onclick="openResponseModal()"><i class="fa-solid fa-plus"></i> Add</button>' +
                        '<button class="btn" onclick="loadDefaults(\'responses\')"><i class="fa-solid fa-download"></i> Load Defaults</button></div></div>';
                    return;
                }

                var html = '';
                snap.forEach(function(doc) {
                    var d = doc.data();
                    var keys = (d.keywords || '').split(',');
                    var keysHtml = '';
                    for (var k = 0; k < keys.length; k++) {
                        var kk = keys[k].trim();
                        if (kk) keysHtml += '<span class="response-keyword">' + esc(kk) + '</span> ';
                    }

                    html += '<div class="response-card" data-search="' + esc((d.keywords || '') + ' ' + (d.response || '')).toLowerCase() + '">' +
                        '<div class="response-header">' +
                            '<div style="display:flex;gap:4px;flex-wrap:wrap;">' + keysHtml + '</div>' +
                            '<span class="badge-status ' + (d.status === 'active' ? 'badge-active' : 'badge-inactive') + '">' + (d.status === 'active' ? 'Active' : 'Hidden') + '</span>' +
                        '</div>' +
                        '<div class="response-text">' + esc((d.response || '').substring(0, 180)) + ((d.response || '').length > 180 ? '...' : '') + '</div>' +
                        '<div class="response-footer">' +
                            '<button class="btn btn-sm" onclick="editResponse(\'' + doc.id + '\')"><i class="fa-solid fa-pen"></i> Edit</button>' +
                            '<button class="btn btn-sm btn-danger" onclick="deleteItem(\'botResponses\',\'' + doc.id + '\',\'chatbot\')"><i class="fa-solid fa-trash"></i></button>' +
                            '<span style="margin-left:auto;font-size:0.7rem;color:#475569;">Priority: ' + (d.priority || 0) + '</span>' +
                        '</div></div>';
                });

                list.innerHTML = html;
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        function searchBot(query) {
            var q = query.toLowerCase();
            var cards = document.querySelectorAll('.response-card');
            for (var i = 0; i < cards.length; i++) {
                var searchText = cards[i].getAttribute('data-search') || '';
                cards[i].style.display = searchText.indexOf(q) !== -1 ? 'block' : 'none';
            }
        }

        function openResponseModal(id) {
            document.getElementById('titleResponse').textContent = id ? 'Edit Response' : 'Add Bot Response';
            document.getElementById('editRId').value = id || '';
            if (!id) { setValue('rKeys',''); setValue('rResp',''); setValue('rPri','0'); setValue('rStatus','active'); }
            document.getElementById('modalResponse').classList.add('active');
        }

        async function editResponse(id) {
            try {
                var doc = await db.collection('botResponses').doc(id).get();
                if (!doc.exists) return;
                var d = doc.data();
                document.getElementById('editRId').value = id;
                setValue('rKeys', d.keywords); setValue('rResp', d.response);
                setValue('rPri', d.priority || 0); setValue('rStatus', d.status);
                document.getElementById('titleResponse').textContent = 'Edit Response';
                document.getElementById('modalResponse').classList.add('active');
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function saveResponse() {
            var keys = getValue('rKeys');
            var resp = getValue('rResp');
            if (!keys || !resp) { toast('Fill keyword & response', 'error'); return; }

            var data = {
                keywords: keys, response: resp,
                priority: parseInt(getValue('rPri')) || 0, status: getValue('rStatus'),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            var editId = getValue('editRId');
            try {
                if (editId) {
                    await db.collection('botResponses').doc(editId).update(data);
                    toast('Response updated!', 'success');
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('botResponses').add(data);
                    toast('Response added!', 'success');
                }
                closeModals();
                await loadResponses();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 13. AI CONFIG
        // =========================================
        async function loadAIConfig() {
            try {
                var doc = await db.collection('settings').doc('aiConfig').get();
                if (!doc.exists) return;
                var d = doc.data();

                var mode = d.chatMode || 'stored';
                var radios = document.querySelectorAll('input[name="chatMode"]');
                for (var i = 0; i < radios.length; i++) {
                    if (radios[i].value === mode) radios[i].checked = true;
                }
                toggleAIBox(mode);

                setValue('aiKey', d.openaiKey);
                setValue('aiPrompt', d.systemPrompt);
                setValue('aiTokens', d.maxTokens || 200);
                setValue('aiFallback', d.fallbackMessage);
            } catch (e) { console.error('AI config error:', e); }
        }

        function toggleAIBox(mode) {
            var box = document.getElementById('aiKeyBox');
            if (box) box.style.display = mode === 'ai' ? 'block' : 'none';
        }

        // Listen for mode change
        (function() {
            var radios = document.querySelectorAll('input[name="chatMode"]');
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener('change', function() {
                    toggleAIBox(this.value);
                });
            }
        })();

        async function saveAIConfig() {
            var mode = 'stored';
            var radios = document.querySelectorAll('input[name="chatMode"]');
            for (var i = 0; i < radios.length; i++) {
                if (radios[i].checked) mode = radios[i].value;
            }

            try {
                await db.collection('settings').doc('aiConfig').set({
                    chatMode: mode,
                    openaiKey: getValue('aiKey'),
                    systemPrompt: getValue('aiPrompt'),
                    maxTokens: parseInt(getValue('aiTokens')) || 200,
                    fallbackMessage: getValue('aiFallback'),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                toast('AI config saved!', 'success');
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 14. CONTACT SUBMISSIONS
        // =========================================
        async function loadSubmissions() {
            try {
                var snap = await db.collection('contactSubmissions').orderBy('createdAt', 'desc').get();
                var list = document.getElementById('submissionsList');
                var count = snap.size;

                setCount('countSubmissions', count);
                setCount('dashSubmissions', count);

                if (count === 0) {
                    list.innerHTML = '<div class="empty-state"><i class="fa-solid fa-envelope"></i><h3>No Submissions</h3><p>Contact form submissions will appear here.</p></div>';
                    return;
                }

                var html = '<div class="table-wrap"><table class="data-table"><thead><tr><th>Name</th><th>Email</th><th>Service</th><th>Message</th><th>Date</th><th>Actions</th></tr></thead><tbody>';

                snap.forEach(function(doc) {
                    var d = doc.data();
                    var date = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleDateString() : 'N/A';

                    html += '<tr>' +
                        '<td><strong>' + esc(d.name) + '</strong></td>' +
                        '<td><a href="mailto:' + esc(d.email) + '" style="color:var(--accent);text-decoration:none;">' + esc(d.email) + '</a></td>' +
                        '<td>' + esc(d.service || '-') + '</td>' +
                        '<td style="max-width:200px;"><div style="color:var(--text-muted);font-size:0.82rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + esc(d.message) + '</div></td>' +
                        '<td style="font-size:0.8rem;color:var(--text-muted);">' + date + '</td>' +
                        '<td><button class="btn btn-sm btn-danger" onclick="deleteItem(\'contactSubmissions\',\'' + doc.id + '\',\'submissions\')"><i class="fa-solid fa-trash"></i></button></td>' +
                    '</tr>';
                });

                html += '</tbody></table></div>';
                list.innerHTML = html;
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 15. ADMIN SETTINGS (Super Admin Only)
        // =========================================
        async function loadAdminEmails() {
            try {
                var doc = await db.collection('settings').doc('admin').get();
                if (!doc.exists) return;
                var emails = doc.data().allowedEmails || [];

                // Show in textarea (without super admin)
                var filtered = [];
                for (var i = 0; i < emails.length; i++) {
                    if (emails[i] !== SUPER_ADMIN) filtered.push(emails[i]);
                }
                setValue('adminEmails', filtered.join('\n'));

                // Show access list
                if (!isSuperAdmin()) return;

                var listEl = document.getElementById('accessList');
                if (!listEl) return;

                var html = '';

                // Super admin
                html += '<div class="admin-crown" style="margin-bottom:6px;">' +
                    '<i class="fa-solid fa-crown"></i>' +
                    '<div style="flex:1;"><div style="font-size:0.85rem;font-weight:600;">' + SUPER_ADMIN + '</div>' +
                    '<div style="font-size:0.7rem;color:var(--primary);">Super Admin (Cannot remove)</div></div>' +
                    '<span class="badge-status badge-active">Active</span></div>';

                // Others
                for (var j = 0; j < emails.length; j++) {
                    if (emails[j] === SUPER_ADMIN) continue;
                    html += '<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;margin-bottom:5px;">' +
                        '<div style="display:flex;align-items:center;gap:8px;">' +
                            '<i class="fa-solid fa-user" style="color:var(--text-muted);"></i>' +
                            '<div><div style="font-size:0.85rem;">' + esc(emails[j]) + '</div><div style="font-size:0.7rem;color:var(--text-muted);">Admin</div></div>' +
                        '</div>' +
                        '<button class="btn btn-sm btn-danger" onclick="removeAdmin(\'' + esc(emails[j]) + '\')"><i class="fa-solid fa-times"></i></button>' +
                    '</div>';
                }

                if (filtered.length === 0) {
                    html += '<p style="color:var(--text-muted);font-size:0.82rem;text-align:center;padding:1rem;">No additional admins.</p>';
                }

                listEl.innerHTML = html;
            } catch (e) { console.error('Admin emails error:', e); }
        }

        async function saveAdminEmails() {
            if (!isSuperAdmin()) { toast('Only super admin!', 'error'); return; }

            var text = getValue('adminEmails');
            var emails = text ? text.split('\n').map(function(e) { return e.trim(); }).filter(function(e) { return e; }) : [];

            // Always include super admin
            if (emails.indexOf(SUPER_ADMIN) === -1) emails.push(SUPER_ADMIN);

            try {
                await db.collection('settings').doc('admin').set({
                    allowedEmails: emails,
                    updatedBy: currentUser.email,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });

                allowedEmails = emails;
                toast('Access list saved!', 'success');
                await loadAdminEmails();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        async function removeAdmin(email) {
            if (!isSuperAdmin()) { toast('Only super admin!', 'error'); return; }
            if (email === SUPER_ADMIN) { toast('Cannot remove super admin!', 'error'); return; }

            try {
                var updated = [];
                for (var i = 0; i < allowedEmails.length; i++) {
                    if (allowedEmails[i] !== email) updated.push(allowedEmails[i]);
                }

                await db.collection('settings').doc('admin').set({
                    allowedEmails: updated,
                    updatedBy: currentUser.email,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });

                allowedEmails = updated;
                toast(email + ' removed!', 'success');
                await loadAdminEmails();
            } catch (e) { toast('Error: ' + e.message, 'error'); }
        }

        // =========================================
        // 16. CLEAR COLLECTION
        // =========================================
        function clearCollection(collName, reloadPanel) {
            document.getElementById('confirmTitle').textContent = 'Clear all data?';
            document.getElementById('confirmMsg').textContent = 'All items in this section will be permanently deleted.';
            document.getElementById('confirmBtn').innerHTML = '<i class="fa-solid fa-trash"></i> Delete All';
            document.getElementById('confirmBtn').className = 'btn btn-danger';
            document.getElementById('confirmBtn').onclick = async function() {
                closeModals();
                toast('Clearing data...', 'info');
                try {
                    var snap = await db.collection(collName).get();
                    var batch = db.batch();
                    snap.forEach(function(doc) { batch.delete(doc.ref); });
                    await batch.commit();
                    toast('All data cleared!', 'success');

                    if (reloadPanel === 'testimonials') await loadTestimonials();
                    if (reloadPanel === 'portfolio') await loadPortfolio();
                    if (reloadPanel === 'services') await loadServices();
                    if (reloadPanel === 'chatbot') await loadResponses();
                    if (reloadPanel === 'submissions') await loadSubmissions();
                } catch (e) { toast('Error: ' + e.message, 'error'); }
            };
            document.getElementById('modalConfirm').classList.add('active');
        }
        // =========================================
        // 17. LOAD DEFAULT DATA
        // =========================================
        function loadDefaults(type) {
            document.getElementById('confirmTitle').textContent = 'Load Default ' + (type === 'responses' ? 'Bot Responses' : 'Testimonials') + '?';
            document.getElementById('confirmMsg').textContent = 'This will ADD default data. Existing items will NOT be deleted.';
            document.getElementById('confirmBtn').innerHTML = '<i class="fa-solid fa-download"></i> Load Defaults';
            document.getElementById('confirmBtn').className = 'btn btn-primary';
            document.getElementById('confirmBtn').onclick = async function() {
                closeModals();

                if (type === 'responses') {
                    await addDefaultResponses();
                } else if (type === 'testimonials') {
                    await addDefaultTestimonials();
                }
            };
            document.getElementById('modalConfirm').classList.add('active');
        }

        async function addDefaultResponses() {
            toast('Loading default responses...', 'info');

            var defaults = [
                { keywords: 'hello, hi, hey, good morning, good evening, good afternoon', response: '👋 Hello! Welcome to Centronix. I\'m your AI assistant.\n\nYou can ask about:\n• Our services\n• Pricing & quotes\n• Contact info\n• Project timelines', priority: 100 },
                { keywords: 'price, cost, pricing, how much, budget, rate, charge, fee, expensive, afford', response: '💼 Our pricing is customized for each project. Every project is unique!\n\nGet a custom quote:\n📧 {email}\n📞 {phone}\n\nOr use the contact form! ⚡', priority: 90 },
                { keywords: 'service, services, offer, provide, do, what do you do, expertise', response: '🛠️ We specialize in:\n\n• 🌐 Web Engineering (React, Next.js)\n• 🤖 AI Integration (ML, Automation)\n• 📱 Mobile Apps (Flutter, React Native)\n• 📈 Digital Growth (SEO, Analytics)\n\n📧 {email}', priority: 85 },
                { keywords: 'contact, reach, talk, speak, call, phone, email, message', response: '📧 Reach us at:\n\n📧 Email: {email}\n📞 Phone: {phone}\n🌐 Website: {website}\n\nWe respond within 24 hours! ⚡', priority: 80 },
                { keywords: 'whatsapp, wa, chat', response: '📱 WhatsApp: {phone}\n\nWe\'ll reply quickly! Also email: {email}', priority: 75 },
                { keywords: 'web, website, webapp, site, landing page, ecommerce', response: '🌐 Web engineering:\n\n• React & Next.js Apps\n• E-commerce Platforms\n• SaaS Dashboards\n• API Development\n• Cloud Deployment\n\n📧 {email}\n📞 {phone}', priority: 70 },
                { keywords: 'mobile, app, ios, android, flutter, react native', response: '📱 Mobile development:\n\n• Flutter Cross-platform\n• React Native\n• iOS & Android\n• App Store Deployment\n• Push Notifications\n\n📧 {email}\n📞 {phone}', priority: 70 },
                { keywords: 'ai, artificial intelligence, machine learning, ml, automation, chatbot, bot', response: '🤖 AI services:\n\n• Custom ML Models\n• Chatbot Development\n• NLP & Computer Vision\n• Process Automation\n• Predictive Analytics\n\n📧 {email}\n📞 {phone}', priority: 70 },
                { keywords: 'seo, marketing, digital marketing, ads, advertising, social media', response: '📈 Digital Growth:\n\n• SEO & SEM\n• Google & Meta Ads\n• Social Media Marketing\n• Content Strategy\n• Analytics & Reporting\n\n📧 {email}\n📞 {phone}', priority: 70 },
                { keywords: 'time, timeline, deadline, how long, duration, deliver, delivery', response: '⏰ Typical timelines:\n\n• Landing Page: 1-2 weeks\n• Full Website: 3-6 weeks\n• Mobile App: 6-12 weeks\n• AI Projects: 4-8 weeks\n\nContact for details:\n📧 {email}\n📞 {phone}', priority: 65 },
                { keywords: 'location, where, address, based, country, office', response: '📍 Based in Sri Lanka 🇱🇰, serving clients worldwide!\n\nUSA, UK, Australia, Middle East & more.\n\n📧 {email}\n📞 {phone}', priority: 60 },
                { keywords: 'technology, tech stack, stack, framework, tools', response: '⚡ Our tech stack:\n\n• Frontend: React, Next.js, Vue\n• Backend: Node.js, Python, Go\n• Mobile: Flutter, React Native\n• Cloud: AWS, GCP, Firebase\n• AI: TensorFlow, PyTorch, OpenAI', priority: 55 },
                { keywords: 'team, developer, designer, who, people', response: '👥 Our team:\n\n• Full-Stack Developers\n• UI/UX Designers\n• AI/ML Engineers\n• Marketing Strategists\n\nAll with 5+ years experience!', priority: 50 },
                { keywords: 'portfolio, work, project, case study, example, previous', response: '🎨 100+ projects delivered!\n\nCheck our portfolio on the website.\n\nWant case studies?\n📧 {email}\n📞 {phone}', priority: 50 },
                { keywords: 'payment, pay, method, bank, paypal, transfer, milestone', response: '💳 Payment options:\n\n• Bank Transfer\n• PayPal\n• Milestone-based\n• 50% upfront, 50% delivery\n\n📧 {email}\n📞 {phone}', priority: 45 },
                { keywords: 'support, maintenance, after, warranty, bug, fix, update', response: '🛡️ Post-launch support:\n\n• Bug Fixes & Updates\n• Performance Monitoring\n• Security Patches\n• Feature Additions\n\nAll projects include warranty!\n📧 {email}', priority: 45 },
                { keywords: 'hire, start, begin, ready, interested, want, need, looking', response: '🚀 Let\'s get started!\n\n1️⃣ Share your project details\n2️⃣ Free consultation\n3️⃣ Detailed proposal\n4️⃣ Start building!\n\n📧 {email}\n📞 {phone}', priority: 40 },
                { keywords: 'quote, estimate, proposal, consultation, free', response: '📋 FREE consultation!\n\n• Detailed proposal\n• Accurate timeline\n• Custom quote\n• Technical recommendations\n\n📧 {email}\n📞 {phone}', priority: 40 },
                { keywords: 'thank, thanks, appreciate, great, awesome, perfect, good, nice, cool', response: '🙏 You\'re welcome! Reach out anytime.\n\n📧 {email}\n📞 {phone}\n\nHave a wonderful day! 😊', priority: 30 },
                { keywords: 'how are, how r u, whats up', response: '😊 Doing great, thanks! Ready to help with your project. What can I assist with?', priority: 30 },
                { keywords: 'bye, goodbye, see you, later, good night', response: '👋 Goodbye! We\'re just a message away.\n\n📧 {email}\n📞 {phone}\n\nHave a great day! 🌟', priority: 20 },
                { keywords: 'okay, ok, sure, alright, got it', response: '👍 Great! Let me know if you have other questions!', priority: 10 },
                { keywords: 'yes, yeah, yep, yup', response: '👍 Awesome! What would you like to know more about?', priority: 10 },
                { keywords: 'no, nope, nah, not really', response: '👍 No problem! I\'m here if you need anything. Have a great day! 😊', priority: 10 }
            ];

            var added = 0;
            for (var i = 0; i < defaults.length; i++) {
                try {
                    await db.collection('botResponses').add({
                        keywords: defaults[i].keywords,
                        response: defaults[i].response,
                        priority: defaults[i].priority,
                        status: 'active',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    added++;
                } catch (e) { console.error('Default response error:', e); }
            }

            toast(added + ' default responses loaded!', 'success');
            await loadResponses();
        }

        async function addDefaultTestimonials() {
            toast('Loading default testimonials...', 'info');

            var defaults = [
                { name: 'Alex Fernando', position: 'CEO, TechVentures', review: 'Centronix transformed our entire digital presence. Their team delivered beyond expectations with a system that\'s both beautiful and functional.', rating: 5 },
                { name: 'Sarah Perera', position: 'CTO, DataFlow Inc', review: 'The AI integration they built reduced our processing time by 70%. Absolutely incredible engineering team with deep technical knowledge.', rating: 5 },
                { name: 'Mark Silva', position: 'Founder, AppStart', review: 'Professional, responsive, and highly skilled. Our mobile app received outstanding reviews from users. Would recommend to anyone.', rating: 5 },
                { name: 'Ravindu Jayasinghe', position: 'Director, ShopEase', review: 'From concept to deployment, Centronix handled everything flawlessly. Our e-commerce platform now handles 10x more traffic seamlessly.', rating: 5 }
            ];

            var added = 0;
            for (var i = 0; i < defaults.length; i++) {
                try {
                    await db.collection('testimonials').add({
                        name: defaults[i].name,
                        position: defaults[i].position,
                        review: defaults[i].review,
                        rating: defaults[i].rating,
                        status: 'active',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    added++;
                } catch (e) { console.error('Default testimonial error:', e); }
            }

            toast(added + ' default testimonials loaded!', 'success');
            await loadTestimonials();
        }

        // =========================================
        // 18. CONSOLE BRANDING
        // =========================================
        console.log('%c CENTRONIX ADMIN ', 'background: linear-gradient(90deg, #7c3aed, #0891b2); color: white; font-size: 16px; padding: 8px 16px; border-radius: 5px;');
        console.log('%c Admin Panel v1.0.0 ', 'color: #06b6d4; font-size: 12px;');
        console.log('%c © 2026 Centronix | Sri Lanka 🇱🇰 ', 'color: #94a3b8; font-size: 11px;');

    </script>
</body>
</html>
